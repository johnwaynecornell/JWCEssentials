#include <iostream>
#include <vector>
#include <string>
#include <cstring>

// Function to split a string by spaces into a vector of strings
std::vector<std::string> splitString(const std::string& command) {
    std::vector<std::string> args;
    std::string arg;
    bool inQuotes = false;

    for (char c : command) {
        if (c == '"') {
            inQuotes = !inQuotes;
        } else if (c == ' ' && !inQuotes) {
            if (!arg.empty()) {
                args.push_back(arg);
                arg.clear();
            }
        } else {
            arg.push_back(c);
        }
    }
    if (!arg.empty()) {
        args.push_back(arg);
    }

    return args;
}

// Function to convert a vector of strings to a format compatible with execv
char** convertToExecvArgs(const std::vector<std::string>& args) {
    char** argv = new char*[args.size() + 1];
    for (size_t i = 0; i < args.size(); ++i) {
        argv[i] = new char[args[i].size() + 1];
        std::strcpy(argv[i], args[i].c_str());
    }
    argv[args.size()] = nullptr; // Null-terminate the array

    return argv;
}

// Function to free the memory allocated for execv arguments
void freeExecvArgs(char** argv, size_t size) {
    for (size_t i = 0; i < size; ++i) {
        delete[] argv[i];
    }
    delete[] argv;
}

int main() {
    std::string command = R"(bash -c "echo Hello, World!")";

    // Split the command string into arguments
    std::vector<std::string> args = splitString(command);

    // Convert the arguments to a format compatible with execv
    char** execvArgs = convertToExecvArgs(args);

    // Example usage with execv (will replace the current process)
    // execv("/bin/bash", execvArgs);

    // For demonstration purposes, print the arguments
    for (size_t i = 0; execvArgs[i] != nullptr; ++i) {
        std::cout << execvArgs[i] << std::endl;
    }

    // Free the allocated memory
    freeExecvArgs(execvArgs, args.size());

    return 0;
}
